# Security Validation Evidence

This directory contains runtime validation evidence for production-readiness claims per `.github/SECURITY_VALIDATION_POLICY.md`.

---

## Purpose

The Security Validation Claims Policy requires **ALL FIVE** runtime validation tests to be executed and documented when making any of the following claims:

- "Production-ready"
- "Enterprise best practices"
- "Complete forensic capability"
- "Runtime enforcement"
- "Operational security"

This directory stores the evidence artifacts generated by the validation test suite.

---

## Required Validations

Per the policy, the following 5 validations are mandatory:

### 1. Unsigned Image Admission Denial ✅

**Requirement:** Deploy an unsigned container image and demonstrate that the admission controller denies the deployment.

**Evidence Required:**
- Deployment command
- Admission controller denial log
- Timestamp
- Confirmation pod not created

### 2. Signed Image Admission Success ✅

**Requirement:** Deploy a properly signed container image and demonstrate that the admission controller allows the deployment.

**Evidence Required:**
- Deployment command
- Admission controller acceptance log
- Signature verification logs
- Pod running status confirmation

### 3. Privileged Container Denial ✅

**Requirement:** Attempt to deploy a container with privileged security context and demonstrate that the admission controller denies the deployment.

**Evidence Required:**
- Deployment command
- Policy violation denial log
- Confirmation pod not created

### 4. Cross-Namespace Communication Denial ✅

**Requirement:** Attempt pod-to-pod communication across namespaces and demonstrate that network policies deny the communication.

**Evidence Required:**
- Communication attempt commands
- Network policy denial evidence
- Source/destination logs
- Network policy configuration

### 5. Log Deletion Prevention ✅

**Requirement:** Attempt to delete logs from a running workload and demonstrate that the system prevents or detects this action.

**Evidence Required:**
- Log deletion attempt commands
- System denial/detection response
- Audit log entry
- Confirmation logs intact

---

## Validation Tools

### Automated Test Suite

**Script:** `../scripts/run_security_validation_tests.sh`

**Description:** Comprehensive automated validation suite that:
- Creates a Kubernetes cluster using kind (Kubernetes in Docker)
- Installs OPA Gatekeeper for admission control
- Executes all 5 required validation tests
- Captures timestamped logs and screenshots
- Generates a complete evidence report

**Usage:**
```bash
# Run all validation tests
./scripts/run_security_validation_tests.sh

# Review generated evidence
cat validation_evidence/VALIDATION_EVIDENCE_REPORT_*.md

# Keep cluster for manual inspection (skip cleanup)
SKIP_CLEANUP=true ./scripts/run_security_validation_tests.sh
```

**Prerequisites:**
- Docker installed and running
- kubectl installed
- kind (Kubernetes in Docker) installed

**Installation:**
```bash
# Install kind (if not already installed)
# macOS
brew install kind

# Linux
curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
chmod +x ./kind
sudo mv ./kind /usr/local/bin/kind

# Windows (PowerShell)
curl.exe -Lo kind-windows-amd64.exe https://kind.sigs.k8s.io/dl/v0.20.0/kind-windows-amd64
Move-Item .\kind-windows-amd64.exe c:\some-dir-in-your-PATH\kind.exe
```

### Manual Validation

If you prefer to run validations manually:

1. **Create Kubernetes cluster:**
   ```bash
   kind create cluster --name security-validation
   ```

2. **Install admission controller:**
   ```bash
   kubectl apply -f https://raw.githubusercontent.com/open-policy-agent/gatekeeper/release-3.14/deploy/gatekeeper.yaml
   ```

3. **Follow test procedures** in `../scripts/run_security_validation_tests.sh`

4. **Capture evidence** using `script` command or manual log collection

---

## Evidence Artifacts

After running the validation suite, this directory will contain:

```
validation_evidence/
├── VALIDATION_EVIDENCE_REPORT_2026-02-20_14-30-00_UTC.md
├── test1_unsigned_denial_2026-02-20_14-30-00_UTC.log
├── test2_signed_success_2026-02-20_14-30-00_UTC.log
├── test3_privileged_denial_2026-02-20_14-30-00_UTC.log
├── test4_network_denial_2026-02-20_14-30-00_UTC.log
└── test5_log_protection_2026-02-20_14-30-00_UTC.log
```

### File Descriptions

- **VALIDATION_EVIDENCE_REPORT_*.md:** Complete evidence report with all test results
- **test1_*.log:** Unsigned image admission denial logs
- **test2_*.log:** Signed image admission success logs
- **test3_*.log:** Privileged container denial logs
- **test4_*.log:** Cross-namespace communication denial logs
- **test5_*.log:** Log deletion prevention logs

All files include UTC timestamps for consistency and auditability.

---

## Compliance Workflow

### For New PRs Making Production Claims

1. **Run validation suite** before creating PR:
   ```bash
   ./scripts/run_security_validation_tests.sh
   ```

2. **Review generated evidence:**
   ```bash
   cat validation_evidence/VALIDATION_EVIDENCE_REPORT_*.md
   ```

3. **Attach evidence to PR:**
   - Copy report content to PR description
   - Upload log files as PR attachments or gist
   - Update PR template to check "YES" for validation evidence

4. **Certify authenticity:**
   - Check all certification boxes in PR template
   - Confirm evidence is reproducible
   - Provide cluster details and timestamps

### For Existing PRs Requiring Compliance

If your PR was flagged for missing validation evidence:

**Option 1: Provide Evidence**
```bash
# Run validation suite
./scripts/run_security_validation_tests.sh

# Attach evidence to PR
# Update PR description with evidence links
```

**Option 2: Reframe Claims**
```bash
# Scan for violations
python scripts/validate_production_claims.py --all

# Update documentation to use safe framing
# Add validation disclaimers
# See PRODUCTION_READINESS_COMPLIANCE_REPORT.md for guidance
```

---

## Evidence Requirements

### Authenticity

All evidence must be:
- ✅ Generated from actual test execution (not mocked)
- ✅ Timestamped in UTC
- ✅ Reproducible by reviewers
- ✅ Captured from clean test environment
- ✅ Complete (all 5 tests, not partial)

### Format

Evidence should include:
- ✅ Full command-line commands executed
- ✅ Complete output logs (not truncated)
- ✅ Success/failure status for each test
- ✅ Cluster configuration details
- ✅ Admission controller policy definitions

### Certification

PR author must certify:
- ✅ Evidence is authentic and reproducible
- ✅ No fabricated or modified logs
- ✅ Tests executed in clean environment
- ✅ All 5 validations completed
- ✅ Understands policy requirements

---

## Troubleshooting

### "kind not found"

Install kind:
```bash
# macOS
brew install kind

# Linux
curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
chmod +x ./kind && sudo mv ./kind /usr/local/bin/kind
```

### "Docker not running"

Start Docker Desktop or Docker daemon:
```bash
# Linux
sudo systemctl start docker

# macOS/Windows: Start Docker Desktop application
```

### "Cluster creation timeout"

Increase timeout or check Docker resources:
```bash
# Allocate more memory to Docker (4GB minimum recommended)
# Check Docker Desktop > Settings > Resources
```

### "Admission controller not enforcing policies"

Wait for Gatekeeper to sync:
```bash
# Check Gatekeeper status
kubectl get pods -n gatekeeper-system

# Wait for constraints to sync (can take 30-60 seconds)
kubectl get constraints
```

### "Tests fail with unexpected results"

1. Clean up previous test artifacts:
   ```bash
   kind delete cluster --name security-validation
   ```

2. Re-run from clean state:
   ```bash
   ./scripts/run_security_validation_tests.sh
   ```

3. If still failing, run tests manually to debug:
   ```bash
   kind create cluster --name security-validation
   kubectl apply -f https://raw.githubusercontent.com/open-policy-agent/gatekeeper/release-3.14/deploy/gatekeeper.yaml
   # Then step through test procedures manually
   ```

---

## Policy Compliance

This validation infrastructure ensures compliance with:

- `.github/SECURITY_VALIDATION_POLICY.md` - Mandatory validation requirements
- `.github/SECURITY_VALIDATION_CHECKLIST.md` - Step-by-step validation guide
- `.github/pull_request_template.md` - PR template validation section

**Policy Status:** Strictly Enforced - No Exceptions

**Last Updated:** 2026-02-20

---

## References

1. **Security Validation Claims Policy:** `../.github/SECURITY_VALIDATION_POLICY.md`
2. **Compliance Report:** `../PRODUCTION_READINESS_COMPLIANCE_REPORT.md`
3. **Validation Script:** `../scripts/run_security_validation_tests.sh`
4. **Detection Script:** `../scripts/validate_production_claims.py`

---

## Contact

For questions about validation requirements:
- Open a discussion in the repository
- Reference the Security Validation Claims Policy
- Tag maintainers for clarification

When in doubt, use safe framing language: "validation is ongoing" is always acceptable.

---

**END OF README**
